---
title: Setup
layout: default
---

<h1>Setting Up STF</h1>

<div class="row">
<div class="span12">
    <h2>Typical Setup</h2>
    <img src="stf-setup.png" width="400" height="300"/>
</div>
</div>

<div class="row">
<div class="span12">
    <h2>MySQL</h2>
    <p>STF requires MySQL 5.x (but please see the section about <a href="#q4m">Q4M</a> before installing MySQL E<gt> 5.1).</p>
    <p>All of the data except for the actual object content will be stored in this MySQL, so you should be careful to tune it and give it ample storage.</p>

    <p>Once you have a MySQL server running, create a new database and set it up using stf.sql (e.g. <a href="https://github.com/stf-storage/stf/misc/stf.sql">https://github.com/stf-storage/stf/misc/stf.sql</a>)</p>
</div>
</div>

<div class="row">
<div class="span12">
    <h2 id="q4m">Q4M</h2>
    <p>STF uses a queue to communicate with the backend workers. This is currently done via Q4M (<a href="http://q4m.github.com">http://q4m.github.com</a>)</p>
    <p>To install Q4M, you need to have MySQL 5.1 available (if you're installing Q4M from source, you will also need the MySQL source code).</p>
    <p>The Q4M instance typically requires much less resources than the main backend MySQL DB, so unless your traffic is extremely large it can be hosted in the same machine as other services (see diagram in "Typical Setup")</p>
    <p>Once you have a Q4M server running, create a new database and set it up using stf_queue.sql (e.g. <a href="https://github.com/stf-storage/stf/misc/stf_queue.sql">https://github.com/stf-storage/stf/misc/stf_queue.sql</a>)</p>
</div>
</div>

<div class="row">
<div class="span12">
    <h2>Dispatcher Proxy (Apache + mod_reproxy)</h2>
    <p>STF currently relies on reproxying via X-Reproxy-URL. Apache does not come with this feature, so we use an add-on called mod_reproxy. You may choose to yse other proxies. If you do, please let us know how it worked out!</p>
    <p>On each of the dispatchers, install Apache 2.2.x and mod_proxy. The mod_reproxy we use is <a href="https://github.com/lestrrat/mod_reproxy">my forked version to work with HEAD requests</a>, which in turn is based on <a href="http://github.com/kazuho/mod_reproxy">Kazuho Oku's original version</a>.</p>
</div>
</div>

<div class="row">
<div class="span12">
    <h2>Workers</h2>
    <p>Workers do a bunch of things, including keeping an eye out on the object's replicas, deleting objects and buckets, and other assorted goodies.</p>
    <p>Workers can be setup pretty much anywhere it can access the Q4M queue. In our diagram from "Typical Setup", we host them on the dispatcher machines, but it's your call.</p>
    <p>The number of workers to activate also depends on your setup. Just make sure that you have enough workers to handle your queue so the queue does not overflow.</p>
</div>
</div>

<div class="row">
<div class="span12">
    <h2>Storage</h2>
    <p>Storages are just dumb HTTP servers that understand basic CRUD via HTTP GET, PUT, DELETE. STF provides you with a simple PSGI app to handle this, but if you happen to find that this is not enough, you can choose to build your own equivalent. It's not that hard.</p>
</div>
</div>

<div class="row">
<div class="span12">
    <h2>Memcached</h2>
    <p>STF uses <a href="http://memcached.org">memcached</a> to boost performance. Typically you can install these on the same machine as the dispatchers</p>
</div>
</div>

